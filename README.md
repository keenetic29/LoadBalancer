# LoadBalancer

### Часть 1. Балансировщик нагрузки
- Реализован HTTP-сервер, который принимает входящие запросы (на порту 8080). 
- При получении запроса балансировщик пересылает его на один из заранее заданных бэкенд-серверов. Адреса серверов задаются через конфигурационный файл ```config.json```. 
- Реализован алгоритм распределения запросов по бэкендам round-robin. 
- Реализована симуляция падения и восстановления бекенд серверов для демонстрации работы алгоритма распределения запросов в боевых ситуациях.
- Реализована обработка ошибок при обращении к бэкендам.
- Реализовано базовое логирование входящих запросов, ошибок и событий (например, смены бэкенда при сбое одного из серверов).

### Часть 2. Реализация Rate-Limiting

- Разработан модуль для ограничения частоты запросов (rate-limiting) на основе алгоритма Token Bucket. Модуль защищает внутренние сервисы от перегрузок, обеспечивает честное распределение ресурсов.


### Дополнительно
- Реализован механизм проверки здоровье бэкендов
- Реализовано корректное завершение работы балансировщика (Graceful Shutdown)
- Реализовано сохранение состояния клиентов (текущие токены, настройки) в файле ```clients.json```.
- Реализовано API для добавления/удаления клиентов (IP) и настройки их лимитов:

Создание клиента: 
```
POST /clients/register 
{
    "client_id": "user1",
    "capacity": 10,
    "rate_per_sec": 1
}
```
Обновление клиента: 
```
PUT /clients/update
{
    "client_id": "user1",
    "capacity": 20,
    "rate_per_sec": 2
}
```
Удаление клиента:
```
DELETE /clients/delete
http://localhost:8080/clients/delete?id=user1
```
Получить клиента:
```
GET /clients/get
http://localhost:8080/clients/get?id=user1
```
Получить всех клиентов:
```
GET /clients/list
http://localhost:8080/clients/list
```
## Сценарий использования
1. Создать клиента
   - Используйте эндпоинт http://localhost:3030/clients/register для создания нового клиента. Передайте данные в формате JSON в теле запроса.

Пример запроса:
![image](https://github.com/user-attachments/assets/e5f98993-0aee-4ecf-9b62-a79b8edbe3b4)

2. Распределение запросов балансировщиком
   - Если у клиента хватает токенов установленных rate-limiter-ом, запрос перенаправляется с помощью балансировщика на один из backend-сервисов, описанных в конфигурационном файле ```config.json```, а также в ```docker-compose.yaml```.
3. Клиент получает ответ от выбранного backend-сервиса.

Пример ответа:
![image](https://github.com/user-attachments/assets/fec3a973-03b3-4637-9a4d-e075fa65df1f)

В определенный момент колиечество токенов может исчерпаться, и в таком случае будет выведена соответствующая ошибка с сообщением:
![image](https://github.com/user-attachments/assets/0764f000-9730-41a3-963f-ec6e31e501b6)

## Запуск проекта
1. Клонируйте репозиторий
2. Выполните docker-compose up --build
